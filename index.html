<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>里程與油耗追蹤器</title>
  <style>
    /* 你的原本 CSS 保留 */
  </style>
</head>
<body>

<div class="tab-nav">
  <div class="tab-nav-item active" data-page="daily">每日記錄</div>
  <div class="tab-nav-item" data-page="history">所有紀錄</div>
</div>

<!-- Daily & History container (省略, 跟你原來一樣) -->

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  const recordDateInput = document.getElementById('recordDate');
  const recordNameInput = document.getElementById('recordName');
  const dailyDistanceInput = document.getElementById('dailyDistance');
  const fuelEfficiencyInput = document.getElementById('fuelEfficiency');
  const fuelCostPerLiterInput = document.getElementById('fuelCostPerLiter');
  const resultsDiv = document.getElementById('results');
  const saveRecordBtn = document.getElementById('saveRecordBtn');
  const clearDataBtn = document.getElementById('clearDataBtn');
  const searchInput = document.getElementById('searchInput');
  const recordsList = document.getElementById('records-list');

  const quickSelectButtons = document.querySelectorAll('.quick-select-buttons button');
  const tabNavItems = document.querySelectorAll('.tab-nav-item');
  const pageContents = document.querySelectorAll('.page-content');
  
  const TABLE_NAME = 'records';
  const COLUMN_NAMES = {
    DATE: 'date',
    NAME: 'name',
    DAILY_DISTANCE: 'daily_distance',
    FUEL_EFFICIENCY: 'fuel_efficiency',
    FUEL_COST_PER_LITER: 'fuel_cost_per_liter'
  };

  // 🔑 你的 Supabase 設定
  const SUPABASE_URL = 'https://emaluilcmlfzysgaxrsi.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVtYWx1aWxjbWxmenlzZ2F4cnNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MTE2MDMsImV4cCI6MjA3MjQ4NzYwM30.WDIW1GzwEtwvn53qlymxlZmPHQiNWZraKFbwnPkoyV4';

  // ✅ 檢查工具
  function checkSupabaseKeys() {
    function hasInvalidChars(str) {
      for (let i = 0; i < str.length; i++) {
        if (str.charCodeAt(i) > 255) return true;
      }
      return false;
    }
    console.log("🔍 檢查 Supabase 設定...");

    if (!SUPABASE_URL.startsWith("https://") || !SUPABASE_URL.includes(".supabase.co")) {
      console.error("❌ SUPABASE_URL 格式錯誤:", SUPABASE_URL);
    } else {
      console.log("✅ SUPABASE_URL 格式正常");
    }

    if (SUPABASE_URL.endsWith("/")) {
      console.warn("⚠️ SUPABASE_URL 不要以 / 結尾:", SUPABASE_URL);
    }

    if (!SUPABASE_ANON_KEY || SUPABASE_ANON_KEY.length < 30) {
      console.error("❌ SUPABASE_ANON_KEY 太短或不存在:", SUPABASE_ANON_KEY);
    } else if (SUPABASE_ANON_KEY.includes("\n") || SUPABASE_ANON_KEY.includes("\r") || hasInvalidChars(SUPABASE_ANON_KEY)) {
      console.error("❌ SUPABASE_ANON_KEY 含有換行或非法字元");
    } else {
      console.log("✅ SUPABASE_ANON_KEY 格式正常");
    }
  }

  checkSupabaseKeys();

  // 🔥 正確初始化 Supabase client
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  /* 你的 calculateDaily / fetchAndRenderRecords / saveDailyRecord 等函數保持不變 */
  
  // ... (略, 保留你原本的功能實作)

  window.addEventListener('load', () => {
    const today = new Date().toISOString().slice(0, 10);
    recordDateInput.value = today;
    fetchAndRenderRecords();
  });
</script>

</body>
</html>
