<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é‡Œç¨‹èˆ‡æ²¹è€—è¿½è¹¤å™¨</title>
  <style>
    /* ä½ çš„åŸæœ¬ CSS ä¿ç•™ */
  </style>
</head>
<body>

<div class="tab-nav">
  <div class="tab-nav-item active" data-page="daily">æ¯æ—¥è¨˜éŒ„</div>
  <div class="tab-nav-item" data-page="history">æ‰€æœ‰ç´€éŒ„</div>
</div>

<!-- Daily & History container (çœç•¥, è·Ÿä½ åŸä¾†ä¸€æ¨£) -->

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  const recordDateInput = document.getElementById('recordDate');
  const recordNameInput = document.getElementById('recordName');
  const dailyDistanceInput = document.getElementById('dailyDistance');
  const fuelEfficiencyInput = document.getElementById('fuelEfficiency');
  const fuelCostPerLiterInput = document.getElementById('fuelCostPerLiter');
  const resultsDiv = document.getElementById('results');
  const saveRecordBtn = document.getElementById('saveRecordBtn');
  const clearDataBtn = document.getElementById('clearDataBtn');
  const searchInput = document.getElementById('searchInput');
  const recordsList = document.getElementById('records-list');

  const quickSelectButtons = document.querySelectorAll('.quick-select-buttons button');
  const tabNavItems = document.querySelectorAll('.tab-nav-item');
  const pageContents = document.querySelectorAll('.page-content');
  
  const TABLE_NAME = 'records';
  const COLUMN_NAMES = {
    DATE: 'date',
    NAME: 'name',
    DAILY_DISTANCE: 'daily_distance',
    FUEL_EFFICIENCY: 'fuel_efficiency',
    FUEL_COST_PER_LITER: 'fuel_cost_per_liter'
  };

  // ğŸ”‘ ä½ çš„ Supabase è¨­å®š
  const SUPABASE_URL = 'https://emaluilcmlfzysgaxrsi.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVtYWx1aWxjbWxmenlzZ2F4cnNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MTE2MDMsImV4cCI6MjA3MjQ4NzYwM30.WDIW1GzwEtwvn53qlymxlZmPHQiNWZraKFbwnPkoyV4';

  // âœ… æª¢æŸ¥å·¥å…·
  function checkSupabaseKeys() {
    function hasInvalidChars(str) {
      for (let i = 0; i < str.length; i++) {
        if (str.charCodeAt(i) > 255) return true;
      }
      return false;
    }
    console.log("ğŸ” æª¢æŸ¥ Supabase è¨­å®š...");

    if (!SUPABASE_URL.startsWith("https://") || !SUPABASE_URL.includes(".supabase.co")) {
      console.error("âŒ SUPABASE_URL æ ¼å¼éŒ¯èª¤:", SUPABASE_URL);
    } else {
      console.log("âœ… SUPABASE_URL æ ¼å¼æ­£å¸¸");
    }

    if (SUPABASE_URL.endsWith("/")) {
      console.warn("âš ï¸ SUPABASE_URL ä¸è¦ä»¥ / çµå°¾:", SUPABASE_URL);
    }

    if (!SUPABASE_ANON_KEY || SUPABASE_ANON_KEY.length < 30) {
      console.error("âŒ SUPABASE_ANON_KEY å¤ªçŸ­æˆ–ä¸å­˜åœ¨:", SUPABASE_ANON_KEY);
    } else if (SUPABASE_ANON_KEY.includes("\n") || SUPABASE_ANON_KEY.includes("\r") || hasInvalidChars(SUPABASE_ANON_KEY)) {
      console.error("âŒ SUPABASE_ANON_KEY å«æœ‰æ›è¡Œæˆ–éæ³•å­—å…ƒ");
    } else {
      console.log("âœ… SUPABASE_ANON_KEY æ ¼å¼æ­£å¸¸");
    }
  }

  checkSupabaseKeys();

  // ğŸ”¥ æ­£ç¢ºåˆå§‹åŒ– Supabase client
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  /* ä½ çš„ calculateDaily / fetchAndRenderRecords / saveDailyRecord ç­‰å‡½æ•¸ä¿æŒä¸è®Š */
  
  // ... (ç•¥, ä¿ç•™ä½ åŸæœ¬çš„åŠŸèƒ½å¯¦ä½œ)

  window.addEventListener('load', () => {
    const today = new Date().toISOString().slice(0, 10);
    recordDateInput.value = today;
    fetchAndRenderRecords();
  });
</script>

</body>
</html>
